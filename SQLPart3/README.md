## _Deep diving into JOINs in SQL_

В этом проекте ты освоишь основные навыки работы с SQL и реляционными базами данных: понимание реляционной алгебры, использование различных типов соединений (JOIN), создание запросов с помощью CTE, обработку пропущенных значений, фильтрацию и сортировку данных.

## Содержание

- [Chapter I](#chapter-i)
- [Введение](#введение)
- [Chapter II](#chapter-ii)
- [Рекомендации к выполнению этого проекта](#рекомендации-к-выполнению-этого-проекта)
- [Chapter III](#chapter-iii)
- [Задание 00 — Move to the LEFT, move to the RIGHT](#задание-00—move-to-the-left-move-to-the-right)
- [Задание 01 — Find data gaps](#задание-01—find-data-gaps)
- [Задание 02 — FULL means 'completely filled'](#задание-02—full-means-completely-filled)
- [Задание 03 — Reformat to CTE](#задание-03—reformat-to-cte)
- [Задание 04 — Find favourite pizzas](#задание-04—find-favourite-pizzas)
- [Задание 05 — Investigate Person Data](#задание-05—investigate-person-data)
- [Задание 06 — Favourite pizzas for Denis and Anna](#задание-06—favourite-pizzas-for-denis-and-anna)
- [Задание 07 — Cheapest pizzeria for Dmitriy](#задание-07—cheapest-pizzeria-for-dmitriy)
- [Задание 08 — Continuing to research data](#задание-08—continuing-to-research-data)
- [Задание 09 — Who loves cheese and pepperoni?](#задание-09—who-loves-cheese-and-pepperoni)
- [Задание 10 — Find persons from one city](#задание-10—find-persons-from-one-city)

## Chapter I
## Введение

Это изображение реляционного выражения в виде дерева. Это выражение соответствует следующему SQL-запросу:

    SELECT * 
        FROM R CROSS JOIN S  
    WHERE clause

Другими словами, любой SQL-запрос можно описать на математическом языке реляционной алгебры.

Ты можешь задать вопрос: "Зачем изучать реляционную алгебру, если SQL можно писать сразу, без неё?"

Ответ — и да, и нет.

**Да,** потому что ты действительно можешь написать SQL-запрос с первой попытки.

**Нет,** потому что без понимания основ реляционной алгебры не обойтись: она используется в оптимизации запросов и их семантическом анализе.

Какие виды соединений существуют в реляционной алгебре? На самом деле, «Cross Join» — это базовый оператор, от которого происходят все остальные типы соединений:

- Natural Join
- Theta Join
- Semi Join
- Anti Join
- Left, Right и Full Joins

Как работает соединение двух таблиц?

Посмотри на фрагмент псевдокода, показывающий логику соединения без использования индексов:

    FOR r in R LOOP  
        FOR s in S LOOP  
        if r.id = s.r_id then add(r,s)  
        …  
        END;  
    END;

Это просто набор циклов... Никакой магии.

## Chapter II
## Рекомендации к выполнению этого проекта

- Убедись, что ты работаешь с последней версией PostgreSQL.
- Ты можешь писать код (SQL-скрипты) в любой удобной IDE - это совершенно нормально.
- В директории должны оставаться только файлы, явно указанные в задании. Настрой .gitignore, чтобы избежать случайных ошибок.
- Убедись, что у тебя есть личная база данных и доступ к ней в твоем кластере PostgreSQL.
- Скачай [скрипт](./model.sql) с моделью базы данных и примени его к своей базе - сделать это можно либо через командную строку с помощью psql, либо через любую удобную IDE, например DataGrip от JetBrains или pgAdmin из сообщества PostgreSQL.
- В каждом задании внимательно ознакомься с разделами «Разрешено» и «Запрещено» - там перечислены допустимые опции базы данных, типы, конструкции SQL и другие важные ограничения.
- Да прибудет с тобой сила SQL!
- Приступай к работе - и пусть это будет увлекательно!

Перед выполнением заданий изучи логическую структуру модели базы данных ниже.

1. **Таблица pizzeria** (справочник пиццерий)
   - поле id - первичный ключ
   - поле name - название пиццерии
   - поле rating - средний рейтинг пиццерии (от 0 до 5 баллов)

2. **Таблица person** (справочник клиентов, любящих пиццу)
   - поле id - первичный ключ
   - поле name - имя человека
   - поле age - возраст человека
   - поле gender - пол человека
   - поле address - адрес человека

3. **Таблица menu** (справочник с доступным меню и ценами на конкретные пиццы)
   - поле id - первичный ключ
   - поле pizzeria_id - внешний ключ на таблицу pizzeria
   - поле pizza_name - название пиццы в пиццерии
   - поле price - цена конкретной пиццы

4. **Таблица person_visits** (журнал посещений пиццерий)
   - поле id - первичный ключ
   - поле person_id - внешний ключ на таблицу person
   - поле pizzeria_id - внешний ключ на таблицу pizzeria
   - поле visit_date - дата посещения (например, 2022-01-01)

5. **Таблица person_order** (журнал заказов)
   - поле id - первичный ключ
   - поле person_id - внешний ключ на таблицу person
   - поле menu_id - внешний ключ на таблицу menu
   - поле order_date - дата заказа (например, 2022-01-01)

Посещения пиццерий и заказы - это разные сущности, между которыми нет прямой зависимости в данных. Например, клиент может находиться в одном ресторане, просто просматривая меню, и одновременно сделать заказ в другом ресторане по телефону или через мобильное приложение. Или другой вариант - быть дома и оформить заказ по телефону, не посещая заведение вовсе.

## Chapter III
## Задание 00 — Move to the LEFT, move to the RIGHT

| Задание 00: Move to the LEFT, move to the RIGHT | |
|------------------------------------------------|--|
| Директория для загрузки решений | ex00 |
| Файлы для загрузки | `day02_ex00.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |
| **Запрещено** | |
| Синтаксические конструкции SQL | `NOT IN`, `IN`, `NOT EXISTS`, `EXISTS`, `UNION`, `EXCEPT`, `INTERSECT` |

Напиши SQL-запрос, который выведет список пиццерий с их рейтингом, но только те, которые никто не посещал.

## Задание 01 — Find data gaps

| Задание 01: Find data gaps | |
|----------------------------|--|
| Директория для загрузки решений | ex01 |
| Файлы для загрузки | `day02_ex01.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |
| Синтаксические конструкции SQL | `generate_series(...)` |
| **Запрещено** | |
| Синтаксические конструкции SQL | `NOT IN`, `IN`, `NOT EXISTS`, `EXISTS`, `UNION`, `EXCEPT`, `INTERSECT` |

Напиши SQL-запрос, который возвращает отсутствующие даты с 1 по 10 января 2022 года (включительно) для посещений людьми с идентификаторами 1 и 2 — то есть дни, пропущенные обоими.

Отсортируй результат по дате посещения в порядке возрастания.

Изучи образец ожидаемого результата ниже.

| missing_date |
|--------------|
| 2022-01-03 |
| 2022-01-04 |
| 2022-01-05 |
| ... |

## Задание 02 — FULL means 'completely filled'

| Задание 02: FULL means 'completely filled' | |
|-------------------------------------------|--|
| Директория для загрузки решений | ex02 |
| Файлы для загрузки | `day02_ex02.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |
| **Запрещено** | |
| Синтаксические конструкции SQL | `NOT IN`, `IN`, `NOT EXISTS`, `EXISTS`, `UNION`, `EXCEPT`, `INTERSECT` |

Напишите SQL-запрос, который возвращает:

- Полный список имен людей, посетивших (или не посетивших) пиццерии в период с 1 по 3 января 2022 года
- Полный список названий пиццерий, которые посещались (или не посещались) в этот же период

Ниже приведен пример данных с указанием требуемых названий колонок.

Для NULL-значений в колонках person_name и pizzeria_name используй замену на '-'. Добавь сортировку по всем трем колонкам.

| person_name | visit_date | pizzeria_name |
|-------------|------------|---------------|
| - | null | DinoPizza |
| - | null | DoDo Pizza |
| Andrey | 2022-01-01 | Dominos |
| Andrey | 2022-01-02 | Pizza Hut |
| Anna | 2022-01-01 | Pizza Hut |
| Denis | null | - |
| Dmitriy | null | - |
| ... | ... | ... |

## Задание 03 — Reformat to CTE

| Задание 03: Reformat to CTE | |
|-----------------------------|--|
| Директория для загрузки решений | ex03 |
| Файлы для загрузки | `day02_ex03.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |
| Синтаксические конструкции SQL | `generate_series(...)` |
| **Запрещено** | |
| Синтаксические конструкции SQL | `NOT IN`, `IN`, `NOT EXISTS`, `EXISTS`, `UNION`, `EXCEPT`, `INTERSECT` |

Вернись к Заданию 01 и перепиши SQL-запрос, используя CTE (Common Table Expression). В CTE-блоке реализуй генератор дат. Результат должен совпадать с результатом из Задания 01.

| missing_date |
|--------------|
| 2022-01-03 |
| 2022-01-04 |
| 2022-01-05 |
| ... |

## Задание 04 — Find favourite pizzas

| Задание 04: Find favourite pizzas | |
|-----------------------------------|--|
| Директория для загрузки решений | ex04 |
| Файлы для загрузки | `day02_ex04.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Найди полную информацию обо всех возможных вариантах пиццерий и ценах на пиццу с грибами или пепперони.

Отсортируй результаты по названию пиццы и названию пиццерии.

Пример ожидаемого результата с названиями колонок приведен ниже (используй те же имена колонок в своем SQL-запросе).

| pizza_name | pizzeria_name | price |
|------------|---------------|-------|
| mushroom pizza | Dominos | 1100 |
| mushroom pizza | Papa Johns | 950 |
| pepperoni pizza | Best Pizza | 800 |
| ... | ... | ... |

## Задание 05 — Investigate Person Data

| Задание 05: Investigate Person Data | |
|-------------------------------------|--|
| Директория для загрузки решений | ex05 |
| Файлы для загрузки | `day02_ex05.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Найди имена всех женщин старше 25 лет и отсортируй результат по имени. Пример вывода приведен ниже.

| name |
|------|
| Elvira |
| ... |

## Задание 06 — Favourite pizzas for Denis and Anna

| Задание 06: Favourite pizzas for Denis and Anna | |
|------------------------------------------------|--|
| Директория для загрузки решений | ex06 |
| Файлы для загрузки | `day02_ex06.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Найдите все названия пицц (и соответствующие названия пиццерий из таблицы menu), которые заказывали Денис или Анна.

Отсортируй результат по обеим колонкам.

Пример вывода данных представлен ниже.

| pizza_name | pizzeria_name |
|------------|---------------|
| cheese pizza | Best Pizza |
| cheese pizza | Pizza Hut |
| ... | ... |

## Задание 07 — Cheapest pizzeria for Dmitriy

| Задание 07: Cheapest pizzeria for Dmitriy | |
|------------------------------------------|--|
| Директория для загрузки решений | ex07 |
| Файлы для загрузки | `day02_ex07.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Определи название пиццерии, которую Дмитрий посетил 8 января 2022 года, где он мог заказать пиццу дешевле 800 рублей.

## Задание 08 — Continuing to research data

| Задание 08: Continuing to research data | |
|----------------------------------------|--|
| Директория для загрузки решений | ex08 |
| Файлы для загрузки | `day02_ex08.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Найди имена всех мужчин из Москвы или Самары, которые заказывали пиццу с пепперони, грибами или оба вида сразу.

Отсортируй результат по именам в обратном алфавитном порядке.

Пример ожидаемого результата приведен ниже.

| name |
|------|
| Dmitriy |
| ... |

## Задание 09 — Who loves cheese and pepperoni?

| Задание 09: Who loves cheese and pepperoni? | |
|--------------------------------------------|--|
| Директория для загрузки решений | ex09 |
| Файлы для загрузки | `day02_ex09.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Найди имена всех женщин, которые заказывали и пепперони, и сырную пиццу (в любое время и в любых пиццериях).

Отсортируй результат по именам в алфавитном порядке.

Пример ожидаемого результата приведен ниже.

| name |
|------|
| Anna |
| ... |

## Задание 10 — Find persons from one city

| Задание 10: Find persons from one city | |
|----------------------------------------|--|
| Директория для загрузки решений | ex10 |
| Файлы для загрузки | `day02_ex10.sql` |
| **Разрешено** | |
| Язык | ANSI SQL |

Найди имена людей, проживающих по одному адресу (в одном городе).

Результат должен быть отсортирован в три колонки: по имени первого человека, имени второго человека и общему адресу.

Пример результата приведен ниже.

Используй в своем запросе указанные ниже названия колонок.

| person_name1 | person_name2 | common_address |
|--------------|--------------|----------------|
| Andrey | Anna | Moscow |
| Denis | Kate | Kazan |
| Elvira | Denis | Kazan |
| ... | ... | ... |
